<!DOCTYPE html>
<html lang="lv">
<head>
    <meta charset="UTF-8">
    <title>Grafika optimizācijas piemēri</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        h2 {
            color: #2c3e50;
            margin-top: 25px;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        h3 {
            color: #34495e;
            margin: 15px 0 10px 0;
        }
        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .example-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .example-card h3 {
            margin: 0 0 8px 0;
            color: #2c3e50;
        }
        .example-description {
            font-size: 13px;
            color: #7f8c8d;
            margin-bottom: 8px;
            font-style: italic;
        }
        .example-details {
            font-size: 12px;
            color: #2c3e50;
            margin-bottom: 15px;
            padding: 5px;
            background-color: #f0f7ff;
            border-radius: 4px;
            display: inline-block;
        }
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            min-width: 70px;
        }
        .view-btn {
            background-color: #95a5a6;
            color: white;
        }
        .view-btn:hover {
            background-color: #7f8c8d;
        }
        .solve-btn {
            background-color: #3498db;
            color: white;
        }
        .solve-btn:hover {
            background-color: #2980b9;
        }
        .benchmark-btn {
            background-color: #2ecc71;
            color: white;
        }
        .benchmark-btn:hover {
            background-color: #27ae60;
        }
        .result-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        .result-content {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: monospace;
        }
        .instruction-text {
            margin: 10px 0;
            line-height: 1.8;
        }
        .instruction-text .main-line {
            margin-bottom: 8px;
        }
        .instruction-text .indented-line {
            margin-left: 20px;
            margin-bottom: 5px;
        }
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }
        .schedule-table th,
        .schedule-table td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        .schedule-table th {
            background-color: #e9ecef;
            font-weight: bold;
        }
        .schedule-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .machines-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }
        .machines-table th,
        .machines-table td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        .machines-table th {
            background-color: #e9ecef;
            font-weight: bold;
        }
        .timeslots-list {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 15px 0;
            font-size: 14px;
        }
        .timeslot-item {
            display: inline-block;
            background-color: #e9ecef;
            padding: 5px 10px;
            margin: 0 5px 5px 0;
            border-radius: 4px;
            font-size: 12px;
        }
        .violations-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }
        .violations-table th,
        .violations-table td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }
        .violations-table th {
            background-color: #e9ecef;
            font-weight: bold;
        }
        .violations-table td div {
            margin: 3px 0;
        }
        .hard-violation {
            color: #e74c3c;
            font-weight: bold;
        }
        .soft-violation {
            color: #f39c12;
            font-weight: bold;
        }
        .score-explanation {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 15px 0;
        }
        .benchmark-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 14px;
        }
        .benchmark-table th,
        .benchmark-table td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
        }
        .benchmark-table th {
            background-color: #e9ecef;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        .benchmark-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .benchmark-table tr:hover {
            background-color: #e9ecef;
        }
        .comparison-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .comparison-column {
            flex: 1;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .error {
            color: #e74c3c;
            padding: 10px;
            border: 1px solid #e74c3c;
            border-radius: 4px;
            background-color: #fdf3f2;
        }
        .badge {
            background-color: #17a2b8;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 5px;
        }
        .badge-improvement {
            background-color: #28a745;
        }
        .badge-step {
            background-color: #6c757d;
        }
        .explanation-section {
            margin-top: 20px;
            padding: 15px 0;
            font-size: 15px;
            color: #333;
            line-height: 1.8;
            border-top: 1px solid #dee2e6;
        }
        .explanation-section strong {
            font-size: 17px;
            display: block;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .explanation-item {
            margin: 8px 0;
            font-size: 15px;
        }
        .score-highlight {
            background-color: #3498db;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .violation-item {
            margin: 5px 0;
        }
        .info-box {
            background-color: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 10px;
            margin: 15px 0;
            font-size: 13px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .stat-item {
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }
        .stat-label {
            font-size: 11px;
            color: #7f8c8d;
        }
        .stat-value {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
        }
    </style>
</head>
<body>
<h1>Grafika optimizācijas piemēri</h1>

<div class="examples-grid" id="examplesGrid">
    <!-- examples tiks ielādēti šeit -->
</div>

<div class="result-container">
    <div class="result-title">Rezultāti</div>
    <div id="result" class="result-content">
        <div class="instruction-text">
            <div class="main-line">Izvēlieties example un noklikšķiniet uz:</div>
            <div class="indented-line"><strong>View</strong> - lai apskatītu sākotnējo grafiku</div>
            <div class="indented-line"><strong>Atrisināt</strong> - lai palaistu optimizāciju</div>
            <div class="indented-line"><strong>Benchmark</strong> - lai salīdzinātu algoritmus</div>
        </div>
    </div>
</div>

<script>
    // Informācija par piemēriem
    const exampleInfo = {
        'Example 1': {
            description: 'Mazs demonstrācijas piemērs',
            details: '8 darbi, 2 mašīnas, 8 laika sloti'
        },
        'Example 2': {
            description: 'Pārslogots grafiks',
            details: '15 darbi, 2 mašīnas, 8 laika sloti'
        },
        'Example 3': {
            description: 'Mašīnu pieejamības ierobežojumi',
            details: '12 darbi, 3 mašīnas, 8 laika sloti'
        },
        'Example 4': {
            description: 'Stingri termiņi',
            details: '12 darbi, 2 mašīnas, 8 laika sloti'
        },
        'Example 5': {
            description: 'Liels piemērs',
            details: '40 darbi, 4 mašīnas, 8 laika sloti'
        }
    };

    document.addEventListener('DOMContentLoaded', loadExamples);

    async function loadExamples() {
        try {
            const response = await fetch('/api/schedule/examples');
            const examples = await response.json();
            displayExamples(examples);
        } catch (error) {
            console.error('Kļūda, ielādējot examples:', error);
            document.getElementById('examplesGrid').innerHTML =
                '<div class="error">Kļūda, ielādējot examples</div>';
        }
    }

    function displayExamples(examples) {
        const grid = document.getElementById('examplesGrid');
        grid.innerHTML = examples.map(example => {
            const info = exampleInfo[example] || { description: 'Standarta piemērs', details: '' };
            return `
                <div class="example-card">
                    <h3>${example}</h3>
                    <div class="example-description">${info.description}</div>
                    <div class="example-details">${info.details}</div>
                    <div class="button-group">
                        <button class="view-btn" onclick="viewExample('${example}')">
                            View
                        </button>
                        <button class="solve-btn" onclick="solveExample('${example}')">
                            Atrisināt
                        </button>
                        <button class="benchmark-btn" onclick="benchmarkExample('${example}')">
                            Benchmark
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    }

    async function viewExample(exampleName) {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '<div class="loading">Ielādē piemēru...</div>';

        try {
            const response = await fetch(`/api/schedule/view-example/${encodeURIComponent(exampleName)}`);
            const schedule = await response.json();

            let html = `<h2>Sākotnējais grafiks: ${exampleName}</h2>`;
            html += `<p style="color: #7f8c8d; margin-bottom: 15px;">${exampleInfo[exampleName].description}</p>`;

            // Statistika
            html += '<div class="stats-grid">';
            html += `<div class="stat-item"><div class="stat-value">${schedule.jobList.length}</div><div class="stat-label">Darbi</div></div>`;
            html += `<div class="stat-item"><div class="stat-value">${schedule.machineList.length}</div><div class="stat-label">Mašīnas</div></div>`;
            html += `<div class="stat-item"><div class="stat-value">${schedule.timeslotList.length}</div><div class="stat-label">Laika sloti</div></div>`;
            html += '</div>';

            // Informācija par mašīnām
            html += '<h3>Mašīnas:</h3>';
            html += '<table class="machines-table">';
            html += '<tr><th>ID</th><th>Nosaukums</th><th>Darba laiks</th></tr>';
            schedule.machineList.forEach(machine => {
                html += '<tr>';
                html += `<td>${machine.id}</td>`;
                html += `<td>${machine.name || machine.id}</td>`;
                html += `<td>${machine.availableFrom}:00 - ${machine.availableTo}:00</td>`;
                html += '</tr>';
            });
            html += '</table>';

            // Informācija par laika slotiem
            html += '<h3>Pieejamie laika sloti:</h3>';
            html += '<div class="timeslots-list">';
            schedule.timeslotList.forEach(slot => {
                html += `<span class="timeslot-item">${slot.startHour}:00-${slot.endHour}:00</span>`;
            });
            html += '</div>';

            // Grafiks
            html += '<h3>Darbu grafiks:</h3>';
            html += generateScheduleTable(schedule);

            if (schedule.score) {
                html += `<div class="score-highlight">
                    Sākotnējais vērtējums: ${schedule.score.hardScore} hard, ${schedule.score.softScore} soft
                </div>`;
            }

            resultDiv.innerHTML = html;

        } catch (error) {
            console.error('Kļūda:', error);
            resultDiv.innerHTML = '<div class="error">Kļūda, ielādējot example</div>';
        }
    }

    async function solveExample(exampleName) {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '<div class="loading">Notiek risināšana... Lūdzu, uzgaidiet.</div>';

        try {
            const response = await fetch(`/api/schedule/solve-example/${encodeURIComponent(exampleName)}`);
            const data = await response.json();
            displaySolveResponse(data, exampleName);
        } catch (error) {
            console.error('Kļūda, risinot example:', error);
            resultDiv.innerHTML = '<div class="error">Kļūda, risinot example</div>';
        }
    }

    async function benchmarkExample(exampleName) {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '<div class="loading">Notiek benchmark... Lūdzu, uzgaidiet.</div>';

        try {
            const response = await fetch(`/api/schedule/benchmark/${encodeURIComponent(exampleName)}`);
            const results = await response.json();
            displayBenchmarkResults(results, exampleName);
        } catch (error) {
            console.error('Kļūda, palaižot benchmark:', error);
            resultDiv.innerHTML = '<div class="error">Kļūda, palaižot benchmark</div>';
        }
    }

    function displaySolveResponse(data, exampleName) {
        let html = `<h2>Optimizācijas rezultāti: ${exampleName}</h2>`;
        html += `<p style="color: #7f8c8d; margin-bottom: 15px;">${exampleInfo[exampleName].description}</p>`;

        // Score explanation
        if (data.scoreExplanation) {
            html += '<h3>Vērtējuma skaidrojums no Timefold: </h3>';
            html += `<div class="score-explanation">${data.scoreExplanation.replace(/\n/g, '<br>')}</div>`;
        }

        // Before and After comparison
        html += '<div class="comparison-container">';

        // BEFORE
        html += '<div class="comparison-column">';
        html += '<h3>PIRMS OPTIMIZĀCIJAS (BEFORE)</h3>';
        html += generateScheduleTable(data.before);
        if (data.before && data.before.score) {
            html += `<div class="score-highlight">Vērtējums: ${data.before.score.hardScore} hard, ${data.before.score.softScore} soft</div>`;
        }
        html += '</div>';

        // AFTER
        html += '<div class="comparison-column">';
        html += '<h3>PĒC OPTIMIZĀCIJAS (AFTER)</h3>';
        html += generateScheduleTable(data.after);
        if (data.after && data.after.score) {
            html += `<div class="score-highlight">Vērtējums: ${data.after.score.hardScore} hard, ${data.after.score.softScore} soft</div>`;
        }
        html += '</div>';

        html += '</div>';

        // Violations
        if (data.violations && data.violations.length > 0) {
            html += '<h3>Pārkāpumi katram darbam:</h3>';
            html += '<table class="violations-table">';
            html += '<tr><th>Darbs</th><th>Hard pārkāpumi</th><th>Soft pārkāpumi</th></tr>';

            data.violations.forEach(violation => {
                html += '<tr>';
                html += `<td><strong>${violation.jobName}</strong></td>`;

                // Hard violations
                html += '<td>';
                if (violation.hardViolations && violation.hardViolations.length > 0) {
                    violation.hardViolations.forEach(v => {
                        html += `<div class="hard-violation violation-item">${v}</div>`;
                    });
                } else {
                    html += '<div style="color: #27ae60;">Nav hard pārkāpumu</div>';
                }
                html += '</td>';

                // Soft violations
                html += '<td>';
                if (violation.softViolations && violation.softViolations.length > 0) {
                    violation.softViolations.forEach(v => {
                        html += `<div class="soft-violation violation-item">${v}</div>`;
                    });
                } else {
                    html += '<div style="color: #27ae60;">Nav soft pārkāpumu</div>';
                }
                html += '</td>';

                html += '</tr>';
            });

            html += '</table>';
        }

        document.getElementById('result').innerHTML = html;
    }

    function generateScheduleTable(schedule) {
        if (!schedule || !schedule.jobList) {
            return '<p>Nav datu</p>';
        }

        let html = '<table class="schedule-table">';
        html += '<tr><th>Darbs</th><th>Iekārta</th><th>Laiks</th><th>Pabeigšana</th><th>Izpildes datums</th><th>Termiņš</th></tr>';

        // Sort by start time
        const sortedJobs = [...schedule.jobList].sort((a, b) => a.startTime - b.startTime);

        sortedJobs.forEach(job => {
            const machineName = job.machine ? (job.machine.name || job.machine.id) : 'Nav piešķirts';
            const timeSlot = job.timeslot ? `${job.timeslot.startHour}:00-${job.timeslot.endHour}:00` : 'Nav piešķirts';

            html += '<tr>';
            html += `<td>${job.name || job.id || 'Nezināms'}</td>`;
            html += `<td>${machineName}</td>`;
            html += `<td>${timeSlot}</td>`;
            html += `<td>${job.finishTime !== undefined ? job.finishTime : 'N/A'}</td>`;
            html += `<td>${job.dueDate !== undefined ? job.dueDate : 'N/A'}</td>`;
            html += `<td>${job.deadline !== undefined ? job.deadline : 'N/A'}</td>`;
            html += '</tr>';
        });

        html += '</table>';
        return html;
    }

    function displayBenchmarkResults(results, exampleName) {
        let html = `<h2>Benchmark salīdzinājums: ${exampleName}</h2>`;
        html += `<p style="color: #7f8c8d; margin-bottom: 15px;">${exampleInfo[exampleName].description}</p>`;
        html += '<table class="benchmark-table">';
        html += '<tr>' +
                '<th>Algoritms</th>' +
                '<th>Vērtējums (Hard/Soft)</th>' +
                '<th>Laiks (ms)</th>' +
                '<th>Kopējie soļi</th>' +
                '<th>Uzlabojumi</th>' +
                '<th>Uzlabojumu ātrums</th>' +
                '<th>Vērtējuma aprēķina ātrums</th>' +
                '<th>Pirmais uzlabojums</th>' +
                '<th>Pēdējais uzlabojums</th>' +
                '</tr>';

        results.forEach(result => {
            html += '<tr>';
            html += `<td><strong>${result.algorithm}</strong></td>`;
            html += `<td>${result.hardScore}/${result.softScore}</td>`;
            html += `<td>${result.durationMs}</td>`;
            html += `<td><span class="badge badge-step">${result.totalSteps ? result.totalSteps.toLocaleString() : '0'}</span></td>`;
            html += `<td><span class="badge badge-improvement">${result.improvements || '0'}</span></td>`;
            html += `<td>${result.improvementSpeed || '0'} uzlab/sek</td>`;
            html += `<td>${result.scoreCalcSpeed ? result.scoreCalcSpeed.toLocaleString() : '0'}/sek</td>`;
            html += `<td><small>${result.firstImprovement || 'N/A'}</small></td>`;
            html += `<td><small>${result.lastImprovement || 'N/A'}</small></td>`;
            html += '</tr>';
        });

        html += '</table>';

        html += '<div class="explanation-section">';
        html += '<strong>Metriku skaidrojums:</strong>';
        html += '<div class="explanation-item">Kopējie soļi - Visi algoritma veiktie soļi (no žurnāliem)</div>';
        html += '<div class="explanation-item">Uzlabojumi - Reižu skaits, kad tika atrasts jauns labākais risinājums</div>';
        html += '<div class="explanation-item">Uzlabojumu ātrums - Cik bieži risinājums uzlabojas (uzlabojumi/sekundē)</div>';
        html += '<div class="explanation-item">Vērtējuma aprēķina ātrums - Cik ātri algoritms novērtē risinājumus (no žurnāliem)</div>';
        html += '</div>';

        document.getElementById('result').innerHTML = html;
    }
</script>
</body>
</html>